---
layout: post
title: Detecting JNI Architecture Is A Pain In The
categories: 
date: 2014-02-28 11:32:44
---
 It sounds like a simple problem: if I want JBoss Modules to choose a directory to read a Java native (JNI) library from, such that each platform (which is comprised of OS, CPU architecture, and ABI variations) gets a separate directory, I should just be able to probe a system property and thus know right where to go, right? Wrong. Until Java 8, the JDK only defines "os.arch" and "os.name" to go on; and these names are far from uniform or standardized.  CPU names for equivalent architectures can vary (e.g. "x86\_64" versus"AMD64"); CPUs may evolve linearly (e.g. "i586" becomes "i686") or non\-linearly (e.g. ARM instruction set offshoots and extended instruction sets like Wireless MMX).  In the end you might be able to load, say, a linux\-i386 native library on linux\-i686, or linux\-armv6 on linux\-armv7a.  And detecting ABI variation is (at least until Java 8) a black art. In the end I've wound up with <a title="some ugly Java code" href="https://github.com/jboss-modules/jboss-modules/blob/master/src/main/java/org/jboss/modules/NativeLibraryResourceLoader.java#L47" target="_blank">this monstrosity</a>. Without a doubt, I will have to fiddle with it as more weird variations are reported.  (By the way, if you discover more weird variations, please <a title="JBoss Modules JIRA" href="http://issues.jboss.org/browse/MODULES" target="_blank">report</a>them!)